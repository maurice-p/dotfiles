/*! For license information please see extension.js.LICENSE.txt */
(()=>{var e={83:(e,t,i)=>{const s=i(896),n=i(857),o=i(928),r=i(982),a={fs:s.constants,os:n.constants},c=/XXXXXX/,l=(a.O_CREAT||a.fs.O_CREAT)|(a.O_EXCL||a.fs.O_EXCL)|(a.O_RDWR||a.fs.O_RDWR),h="win32"===n.platform(),d=a.EBADF||a.os.errno.EBADF,u=a.ENOENT||a.os.errno.ENOENT,m=[],f=s.rmdirSync.bind(s);let C=!1;function p(e,t){return s.rm(e,{recursive:!0},t)}function g(e){return s.rmSync(e,{recursive:!0})}function w(e,t){const i=E(e,t),n=i[0],o=i[1];try{D(n)}catch(e){return o(e)}let r=n.tries;!function e(){try{const t=F(n);s.stat(t,(function(i){if(!i)return r-- >0?e():o(new Error("Could not get a unique tmp filename, max tries reached "+t));o(null,t)}))}catch(e){o(e)}}()}function v(e){const t=E(e)[0];D(t);let i=t.tries;do{const e=F(t);try{s.statSync(e)}catch(t){return e}}while(i-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function k(e,t){const i=function(e){if(e&&!V(e))return t(e);t()};0<=e[0]?s.close(e[0],(function(){s.unlink(e[1],i)})):s.unlink(e[1],i)}function y(e){let t=null;try{0<=e[0]&&s.closeSync(e[0])}catch(e){if(!O(e,-d,"EBADF")&&!V(e))throw e}finally{try{s.unlinkSync(e[1])}catch(e){V(e)||(t=e)}}if(null!==t)throw t}function b(e,t,i,s){const n=L(y,[t,e],s),o=L(k,[t,e],s,n);return i.keep||m.unshift(n),s?n:o}function P(e,t,i){const n=t.unsafeCleanup?p:s.rmdir.bind(s),o=L(t.unsafeCleanup?g:f,e,i),r=L(n,e,i,o);return t.keep||m.unshift(o),i?o:r}function L(e,t,i,s){let n=!1;return function o(r){if(!n){const a=s||o,c=m.indexOf(a);return c>=0&&m.splice(c,1),n=!0,i||e===f||e===g?e(t):e(t,r||function(){})}}}function x(e){let t=[],i=null;try{i=r.randomBytes(e)}catch(t){i=r.pseudoRandomBytes(e)}for(var s=0;s<e;s++)t.push("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[i[s]%62]);return t.join("")}function S(e){return void 0===e}function E(e,t){if("function"==typeof e)return[{},e];if(S(e))return[{},t];const i={};for(const t of Object.getOwnPropertyNames(e))i[t]=e[t];return[i,t]}function F(e){const t=e.tmpdir;if(!S(e.name))return o.join(t,e.dir,e.name);if(!S(e.template))return o.join(t,e.dir,e.template).replace(c,x(6));const i=[e.prefix?e.prefix:"tmp","-",process.pid,"-",x(12),e.postfix?"-"+e.postfix:""].join("");return o.join(t,e.dir,i)}function D(e){e.tmpdir=H(e);const t=e.tmpdir;if(S(e.name)||j(e.name,"name",t),S(e.dir)||j(e.dir,"dir",t),!S(e.template)&&(j(e.template,"template",t),!e.template.match(c)))throw new Error(`Invalid template, found "${e.template}".`);if(!S(e.tries)&&isNaN(e.tries)||e.tries<0)throw new Error(`Invalid tries, found "${e.tries}".`);var i;e.tries=S(e.name)?e.tries||3:1,e.keep=!!e.keep,e.detachDescriptor=!!e.detachDescriptor,e.discardDescriptor=!!e.discardDescriptor,e.unsafeCleanup=!!e.unsafeCleanup,e.dir=S(e.dir)?"":o.relative(t,U(e.dir,t)),e.template=S(e.template)?void 0:o.relative(t,U(e.template,t)),e.template=null===(i=e.template)||S(i)||!i.trim()?void 0:o.relative(e.dir,e.template),e.name=S(e.name)?void 0:e.name,e.prefix=S(e.prefix)?"":e.prefix,e.postfix=S(e.postfix)?"":e.postfix}function U(e,t){return e.startsWith(t)?o.resolve(e):o.resolve(o.join(t,e))}function j(e,t,i){if("name"===t){if(o.isAbsolute(e))throw new Error(`${t} option must not contain an absolute path, found "${e}".`);let i=o.basename(e);if(".."===i||"."===i||i!==e)throw new Error(`${t} option must not contain a path, found "${e}".`)}else{if(o.isAbsolute(e)&&!e.startsWith(i))throw new Error(`${t} option must be relative to "${i}", found "${e}".`);let s=U(e,i);if(!s.startsWith(i))throw new Error(`${t} option must be relative to "${i}", found "${s}".`)}}function V(e){return O(e,-u,"ENOENT")}function O(e,t,i){return h?e.code===i:e.code===i&&e.errno===t}function H(e){return o.resolve(e&&e.tmpdir||n.tmpdir())}process.addListener("exit",(function(){if(C)for(;m.length;)try{m[0]()}catch(e){}})),Object.defineProperty(e.exports,"tmpdir",{enumerable:!0,configurable:!1,get:function(){return H()}}),e.exports.dir=function(e,t){const i=E(e,t),n=i[0],o=i[1];w(n,(function(e,t){if(e)return o(e);s.mkdir(t,n.mode||448,(function(e){if(e)return o(e);o(null,t,P(t,n,!1))}))}))},e.exports.dirSync=function(e){const t=E(e)[0],i=v(t);return s.mkdirSync(i,t.mode||448),{name:i,removeCallback:P(i,t,!0)}},e.exports.file=function(e,t){const i=E(e,t),n=i[0],o=i[1];w(n,(function(e,t){if(e)return o(e);s.open(t,l,n.mode||384,(function(e,i){if(e)return o(e);if(n.discardDescriptor)return s.close(i,(function(e){return o(e,t,void 0,b(t,-1,n,!1))}));{const e=n.discardDescriptor||n.detachDescriptor;o(null,t,i,b(t,e?-1:i,n,!1))}}))}))},e.exports.fileSync=function(e){const t=E(e)[0],i=t.discardDescriptor||t.detachDescriptor,n=v(t);var o=s.openSync(n,l,t.mode||384);return t.discardDescriptor&&(s.closeSync(o),o=void 0),{name:n,fd:o,removeCallback:b(n,i?-1:o,t,!0)}},e.exports.tmpName=w,e.exports.tmpNameSync=v,e.exports.setGracefulCleanup=function(){C=!0}},684:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCAnnotationController=void 0;const s=i(398);t.CCAnnotationController=class{constructor(e,t){this.editor=e,this.configHandler=t,this.mIsActive=!1,this.mDisposables=[],this.mDisposables.push(s.window.onDidChangeActiveTextEditor((e=>this.onActiveEditorChange(e)))),this.mDisposables.push(this.configHandler.onDidChangeConfiguration((()=>this.onConfigurationChanged()))),this.mDecorationType=s.window.createTextEditorDecorationType({isWholeLine:!1,before:{margin:"0 1em 0 0"},after:{margin:"0 0 0 1em"}}),this.mConfiguration=this.configHandler.configuration}onActiveEditorChange(e){e&&(this.mIsActive=!1,this.editor=e)}onConfigurationChanged(){this.mConfiguration=this.configHandler.configuration}setAnnotationInText(e){let t=[],i=0;if(!1===this.mIsActive){const s=e.split(/[\n\r]+/).map((e=>{const t=e.split(" | ");return t[0]=t[0].replace(/\\/g,"/"),t[0].length>i&&(i=t[0].length),t}));t=this.getDecoration(s,i),this.mIsActive=!0}else this.mIsActive=!1;this.editor.setDecorations(this.mDecorationType,t)}getDecoration(e,t){const i=[];for(let s=0;s<e.length;s++){let n=e[s][0].replace(/ /gi," ");for(;n.length<t;)n=n.concat(" ");i.push(this.createLineDecoration(n,s,0))}return i}createLineDecoration(e,t,i){const n=e.length;let o=s.window.activeTextEditor?.document.validateRange(new s.Range(t,i,t,n));return void 0===o&&(o=new s.Range(0,0,0,0)),{hoverMessage:"",range:o,renderOptions:{before:{color:this.mConfiguration.annotationColor.value,backgroundColor:this.mConfiguration.annotationBackground.value,contentText:e}}}}dispose(){}}},336:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCAnnotateLens=void 0;const s=i(398);class n extends s.CodeLens{constructor(e,t){super(t),this.document=e}}t.CCAnnotateLens=n},1:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCCodeLensProvider=void 0;const s=i(398),n=i(336);class o{constructor(e,t){this.mCfg=e,this.mProvider=t}provideCodeLenses(e,t){return this.mCfg.configuration.showAnnotationCodeLens.value?this.getCodeLenses(e,t):[]}async getCodeLenses(e,t){if(!0===t.isCancellationRequested)return[];const i=await(this.mProvider.clearCase?.isClearcaseObject(e.uri))??!1;return void 0!==e&&i?[new n.CCAnnotateLens(e,new s.Range(0,0,0,1))]:[]}resolveCodeLens(e,t){return!0===t.isCancellationRequested?e:e instanceof n.CCAnnotateLens?(e.command={title:"Toggle annotations",command:"extension.ccAnnotate",arguments:[e.document.uri]},e):Promise.reject()}}t.CCCodeLensProvider=o,o.selector={scheme:"file"}},768:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCConfigHandler=void 0;const s=i(398),n=i(120);t.CCConfigHandler=class{constructor(){this.mConfigChanged=new s.EventEmitter,this.mConfiguration=new n.CCConfiguration,this.mChangeIdents=[],this.mDisposables=[],this.mDisposables.push(s.workspace.onDidChangeConfiguration((()=>this.handleChangedConfig()))),this.handleChangedConfig()}dispose(){this.mDisposables.forEach((e=>e.dispose()))}get onDidChangeConfiguration(){return this.mConfigChanged.event}get configuration(){return this.mConfiguration}loadConfig(){const e=s.workspace.getConfiguration("vscode-clearcase");return!!e&&(this.mChangeIdents=[],this.setChangeConfigDate(e,"showVersionInStatusbar",this.mConfiguration.showStatusbar),this.setChangeConfigDate(e,"annotation.showAnnotationCodeLens",this.mConfiguration.showAnnotationCodeLens),this.setChangeConfigDate(e,"annotation.color",this.mConfiguration.annotationColor),this.setChangeConfigDate(e,"annotation.backgroundColor",this.mConfiguration.annotationBackground),this.setChangeConfigDate(e,"annotation.formatString",this.mConfiguration.annotationFormatString),this.setChangeConfigDate(e,"cleartool.useDialog",this.mConfiguration.useClearDlg),this.setChangeConfigDate(e,"cleartool.checkoutCommandArguments",this.mConfiguration.checkoutCommand),this.setChangeConfigDate(e,"cleartool.findCheckoutsCommandArguments",this.mConfiguration.findCheckoutsCommand),this.setChangeConfigDate(e,"cleartool.findViewPrivateCommandArguments",this.mConfiguration.findViewPrivateCommand),this.setChangeConfigDate(e,"cleartool.findHijackedCommandArguments",this.mConfiguration.findHijackedCommand),this.setChangeConfigDate(e,"cleartool.showHijackedFiles",this.mConfiguration.showHijackedFiles),this.setChangeConfigDate(e,"cleartool.showViewPrivateFiles",this.mConfiguration.showViewPrivateFiles),this.setChangeConfigDate(e,"cleartool.checkinCommandArguments",this.mConfiguration.checkinCommand),this.setChangeConfigDate(e,"cleartool.defaultComment",this.mConfiguration.defaultComment),this.setChangeConfigDate(e,"viewPrivateFileSuffixes",this.mConfiguration.viewPrivateFileSuffixes),this.setChangeConfigDate(e,"cleartool.executable",this.mConfiguration.executable),this.setChangeConfigDate(e,"tempDir",this.mConfiguration.tempDir),this.setChangeConfigDate(e,"cleartool.undoCheckoutKeepFile",this.mConfiguration.uncoKeepFile),this.setChangeConfigDate(e,"remoteCleartool.enable",this.mConfiguration.useRemoteClient),this.setChangeConfigDate(e,"remoteCleartool.webviewUsername",this.mConfiguration.webserverUsername),this.setChangeConfigDate(e,"remoteCleartool.webviewPassword",this.mConfiguration.webserverPassword),this.setChangeConfigDate(e,"remoteCleartool.webviewAddress",this.mConfiguration.webserverAddress),this.setChangeConfigDate(e,"wsl.detectEnvironment",this.mConfiguration.detectWslEnvironment),this.setChangeConfigDate(e,"wsl.pathMapping",this.mConfiguration.pathMapping),this.setChangeConfigDate(e,"diffViewerEncoding",this.mConfiguration.diffViewEncoding),this.setChangeConfigDate(e,"useLabelAtCheckin",this.mConfiguration.useLabelAtCheckin),this.setChangeConfigDate(e,"logLevel",this.mConfiguration.logLevel),!0)}handleChangedConfig(){this.loadConfig()&&this.mConfigChanged.fire(this.mChangeIdents)}setChangeConfigDate(e,t,i){return!(!e.has(t)||(i.value=e.get(t),!i.changed)||(i.changed=!0,this.mChangeIdents.push(t),0))}}},120:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCConfiguration=t.ConfigurationProperty=t.Variables=t.PathMapping=void 0;const s=i(694);t.PathMapping=class{constructor(){this.host="",this.wsl=""}};class n{static parse(e){if(null===e||""===e||"string"!=typeof e)return e;if("string"==typeof e){const t=e.indexOf("env:");let i=e;if(t>0){const t=e.matchAll(/\$\{env:(\w+)\}/gi);for(const e of t)if(e.length>0&&e[1]in process.env){const t=process.env[e[1]];void 0!==t&&(i=i.replace(e[0],t))}}return i}return e}}t.Variables=n;class o{constructor(e){this.mChanged=!0,this.mProp=n.parse(e)}get value(){return this.mProp}set value(e){this.mProp!==e&&(this.mProp=n.parse(e),this.mChanged=!0)}get changed(){const e=this.mChanged;return this.mChanged=!1,e}set changed(e){this.mChanged=e}}t.ConfigurationProperty=o,t.CCConfiguration=class{constructor(){this.mShowStatusbar=new o(!0),this.mAnnotationColor=new o("rgba(220, 220, 220, 0.8)"),this.mAnnotationBackgroundColor=new o("rgba(20, 20, 20, 0.8)"),this.mAnnotationFormatString=new o("%d %12u"),this.mShowAnnotationCodeLens=new o(!0),this.mUseClearDlg=new o(!0),this.mCheckoutCommand=new o("-comment ${comment} ${filename}"),this.mFindCheckoutsCommand=new o("-me -cview -short -avobs"),this.mFindViewPrivateCommand=new o("ls -rec -view_only ${env:CLEARCASE_AVOBS}"),this.mFindHijackedCommand=new o("ls -rec ${env:CLEARCASE_AVOBS}"),this.mUncoKeepFile=new o(!0),this.mCheckinCommand=new o("-comment ${comment} ${filename}"),this.mDefaultComment=new o(""),this.mViewPrivateFiles=new o("(hh|cpp|def|c|h|txt)$"),this.mExecutable=new o("cleartool.exe"),this.mTempDir=new o("c:\\Temp"),this.mUseRemoteClient=new o(!1),this.mWebserverUsername=new o(""),this.mWebserverPassword=new o(""),this.mWebserverAddress=new o(""),this.mDetectWslEnvironment=new o(!1),this.mPathMapping=new o([]),this.mDiffEncoding=new o(""),this.mUseLabelWhenCheckin=new o(!1),this.mShowHijackedFiles=new o(!1),this.mShowViewPrivateFiles=new o(!1),this.mLogLevel=new o(s.LogLevel.None)}get showStatusbar(){return this.mShowStatusbar}get showAnnotationCodeLens(){return this.mShowAnnotationCodeLens}get annotationColor(){return this.mAnnotationColor}get annotationBackground(){return this.mAnnotationBackgroundColor}get annotationFormatString(){return this.mAnnotationFormatString}get useClearDlg(){return this.mUseClearDlg}get checkoutCommand(){return this.mCheckoutCommand}get checkinCommand(){return this.mCheckinCommand}get findCheckoutsCommand(){return this.mFindCheckoutsCommand}get findViewPrivateCommand(){return this.mFindViewPrivateCommand}get findHijackedCommand(){return this.mFindHijackedCommand}get showHijackedFiles(){return this.mShowHijackedFiles}get showViewPrivateFiles(){return this.mShowViewPrivateFiles}get uncoKeepFile(){return this.mUncoKeepFile}get defaultComment(){return this.mDefaultComment}get viewPrivateFileSuffixes(){return this.mViewPrivateFiles}get executable(){return this.mExecutable}get tempDir(){return this.mTempDir}get useRemoteClient(){return this.mUseRemoteClient}get webserverUsername(){return this.mWebserverUsername}get webserverPassword(){return this.mWebserverPassword}get webserverAddress(){return this.mWebserverAddress}get detectWslEnvironment(){return this.mDetectWslEnvironment}get pathMapping(){return this.mPathMapping}get diffViewEncoding(){return this.mDiffEncoding}get useLabelAtCheckin(){return this.mUseLabelWhenCheckin}get logLevel(){return this.mLogLevel}}},462:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCContentProvider=void 0;const s=i(398),n=i(230),o=i(916);t.CCContentProvider=class{constructor(e){this.mCcHandler=e,this.mDisposals=[],this.mOriginalContent="",this.mOriginalPath="",this.mOriginalVersion=new o.CCVersionType,null!==this.mCcHandler&&(this.mDisposals.push(s.workspace.registerTextDocumentContentProvider("cc",this)),this.mDisposals.push(s.workspace.registerTextDocumentContentProvider("cc-orig",this)))}provideTextDocumentContent(e,t){return this.getTextDocumentContent(e,t)}async getTextDocumentContent(e,t){if(!0===t.isCancellationRequested)return"canceled";"cc-orig"===e.scheme&&(e=e.with({scheme:"cc",path:e.query}));const{path:i,version:s}=(0,n.fromCcUri)(e);try{let t="";return""!==this.mOriginalPath&&""!==this.mOriginalContent&&this.mOriginalPath===e.fsPath||(this.mOriginalContent=t=this.mCcHandler?await this.mCcHandler.readFileAtVersion(i,s):""),t}catch(e){console.log(e)}return""}provideOriginalResource(e,t){return this.getOriginalResource(e,t)}async getOriginalResource(e,t){if(!0===t?.isCancellationRequested)return;if("file"!==e.scheme)return;if(""!==e.fragment)return(0,n.toCcUri)(e,e.fragment);let i=this.mOriginalVersion;if(this.mOriginalPath!==e.fsPath&&(i=await(this.mCcHandler?.getVersionInformation(e,!1))??new o.CCVersionType,this.mOriginalVersion=i,this.mOriginalPath=e.fsPath),i){if(i.version.match(/(checkedout)$/i)){const t=await(this.mCcHandler?.getFilePredecessorVersion(e.fsPath))??new o.CCVersionType(i.version.replace(/(CHECKEDOUT)$/i,"LATEST"));return(0,n.toCcUri)(e,t.version)}if(1===i.state)return(0,n.toCcUri)(e,i.version)}}resetCache(){this.mOriginalPath="",this.mOriginalContent="",this.mOriginalVersion=new o.CCVersionType}dispose(){this.mDisposals.forEach((e=>e.dispose()))}}},694:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevel=void 0,function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(i=t.LogLevel||(t.LogLevel={})),t.default=class{constructor(e){this.outputChannelBase=e,this.debug=i.None,this.name=e.name}append(e,t){void 0!==t&&this.debug<=t&&this.outputChannelBase.append(e)}appendLine(e,t){void 0!==t&&this.debug<=t&&this.outputChannelBase.appendLine(e)}replace(e){this.debug&&this.outputChannelBase.replace(e)}clear(){this.outputChannelBase.clear()}show(e,t){this.outputChannelBase.show(t)}hide(){this.outputChannelBase.hide()}dispose(){this.outputChannelBase.dispose()}set logLevel(e){this.debug=e}get logLevel(){return this.debug}}},22:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCScmProvider=void 0;const s=i(398),n=i(259),o=i(453),r=i(477),a=i(684),c=i(1),l=i(462),h=i(896),d=i(238),u=i(230),m=i(928),f=i(767),C=i(916),p=i(694),g=i(613),w=(0,r.loadMessageBundle)();t.CCScmProvider=class{get root(){if(void 0!==s.workspace.workspaceFolders&&s.workspace.workspaceFolders.length>0)return s.workspace.workspaceFolders[0].uri}constructor(e,t,i){this.mContext=e,this.outputChannel=t,this.configHandler=i,this.mCCContentProvider=null,this.mCCHandler=null,this.mCCScm=null,this.mCCCheckedoutGrp=null,this.mCCUntrackedGrp=null,this.mCCHijackedGrp=null,this.mCCUntrackedResource=[],this.mCCHijackedResource=[],this.mIsUpdatingUntracked=!1,this.mIsUpdatingHijacked=!1,this.mListLock=null,this.mDisposables=[],this.mVersion="0.0.0",this.mWindowChangedEvent=new s.EventEmitter,this.configHandler.onDidChangeConfiguration((async()=>{this.configHandler.configuration.logLevel.changed&&(this.outputChannel.logLevel=this.configHandler.configuration.logLevel.value),this.configHandler.configuration.showHijackedFiles.changed&&(this.updateHijackedResourceGroup(),await this.createHijackedList()),this.configHandler.configuration.showViewPrivateFiles.changed&&(this.updateUntrackedResourceGroup(),await this.createViewPrivateList()),this.updateContextResources(void 0!==s.window.activeTextEditor)})),t.logLevel=this.configHandler.configuration.logLevel.value}async init(){if(this.mListLock=new d.Lock(1),this.mCCHandler=new o.ClearCase(this.configHandler,this.outputChannel),!0===this.configHandler.configuration.useRemoteClient.value)if(""!==this.configHandler.configuration.webserverPassword.value){if(this.clearCase){this.clearCase.password=this.configHandler.configuration.webserverPassword.value,await this.clearCase.loginWebview();try{return await this.startExtension()}catch{return!1}}}else{const e=await s.window.showInputBox({password:!0,prompt:"Insert password for webview connection",ignoreFocusOut:!0});if(void 0===e||null===this.clearCase)return!1;this.clearCase.password=e,await this.clearCase.loginWebview();try{return await this.startExtension()}catch{return!1}}else try{return await this.startExtension()}catch{return!1}return!1}async startExtension(){let e=!1;try{e=await(this.mCCHandler?.checkIsView(void 0))??!1}catch{e=!1}if(e){this.configHandler.configuration.detectWslEnvironment.value&&this.mCCHandler?.detectIsWsl();const t=!!this.clearCase&&this.clearCase.viewType===o.ViewType.Dynamic;s.commands.executeCommand("setContext","vscode-clearcase:enabled",e),s.commands.executeCommand("setContext","vscode-clearcase:DynView",t),this.mVersion=this.mContext.extension?.packageJSON?.version,(this.mVersion!==this.mContext.workspaceState.get("version","")||process.env.VSCODE_DEBUG_MODE)&&(this.mContext.workspaceState.update("untrackedfilecache",""),this.mContext.workspaceState.update("version",this.mVersion));const i=this.mContext.workspaceState.get("untrackedfilecache",[]);this.clearCase?.untrackedList.parse(i),this.mCCScm=s.scm.createSourceControl("cc","ClearCase",this.root),this.mCCCheckedoutGrp=this.mCCScm.createResourceGroup("cc_checkedout","Checked out"),this.mCCUntrackedGrp=this.mCCScm.createResourceGroup("cc_untracked","View private"),this.mCCHijackedGrp=this.mCCScm.createResourceGroup("cc_hijacked","Hijacked"),this.mCCCheckedoutGrp.hideWhenEmpty=!0,this.mCCUntrackedGrp.hideWhenEmpty=!0,this.mCCHijackedGrp.hideWhenEmpty=!0,this.mCCContentProvider=new l.CCContentProvider(this.mCCHandler),this.mDisposables.push(this.mCCScm),this.mDisposables.push(this.mCCContentProvider),this.mCCScm.inputBox.placeholder="Message (press Ctrl+Enter to checkin all files)",this.mCCScm.acceptInputCommand={command:"extension.ccCheckinAll",title:w("checkinall","Check In All")},this.mCCContentProvider&&(this.mCCScm.quickDiffProvider=this.mCCContentProvider),this.clearCase?.onCommandExecuted((e=>{this.handleChangeFiles(e)})),this.bindScmCommand(),this.mIsUpdatingUntracked=!1,this.updateCheckedOutList(),this.createHijackedList(),this.createViewPrivateList(),this.onDidChangeTextEditor(s.window.activeTextEditor);let n=this.configHandler.configuration.tempDir.value;if(this.mCCHandler?.isRunningInWsl()&&(n=this.mCCHandler.wslPath(n)),!(0,h.existsSync)(n)){const e=[{title:"Create Directory"},{title:"Open Settings"},{title:"Ignore"}],t=await s.window.showInformationMessage(`The configured temp folder ${n} does not exist. Do you want to created it or change the settings?`,...e);switch(t?.title){case e[0].title:try{(0,h.mkdirSync)(n)}catch(e){s.window.showErrorMessage(`Could not create temp folder ${e}`)}break;case e[1].title:s.commands.executeCommand("workbench.action.openSettings","@ext:openningia.vscode-clearcase tempDir")}}return!0}return!1}get clearCase(){return this.mCCHandler}async updateIsView(){return this.clearCase?.checkIsView(s.window.activeTextEditor)??!1}updateContextResources(e){const t=!!this.mCCHandler&&this.mCCHandler.viewType===o.ViewType.Dynamic,i=this.getCheckedoutObjects(),n=this.getHijackedObjects(),r=this.getUntrackedObjects();s.commands.executeCommand("setContext","vscode-clearcase:enabled",this.mCCHandler?.isView),s.commands.executeCommand("setContext","vscode-clearcase:DynView",t),s.commands.executeCommand("setContext","vscode-clearcase:CheckedoutObjects",i),s.commands.executeCommand("setContext","vscode-clearcase:HijackedObjects",n),s.commands.executeCommand("setContext","vscode-clearcase:ViewPrivateObjects",r),s.commands.executeCommand("setContext","vscode-clearcase:editor",e)}async handleChangeFiles(e){if(this.mListLock?.reserve())for(const t of e)try{const e=await(this.clearCase?.getVersionInformation(t))??new C.CCVersionType;let i=!1;const o=this.mCCCheckedoutGrp?.resourceStates.filter((e=>e.resourceUri.fsPath!==t.fsPath||(i=!0,!1)))??[];null!==e?.version.match(/checkedout/i)&&(o?.push(new n.CCScmResource(1,t,1)),i=!0),this.updateHijackedList(t,e),this.updateViewPrivateList(t,e),i&&null!==this.mCCCheckedoutGrp&&(this.mCCCheckedoutGrp.resourceStates=o?.sort(((e,t)=>n.CCScmResource.sort(e,t)))||[]),this.updateContextResources(void 0!==s.window.activeTextEditor)}catch(e){this.outputChannel.appendLine("Clearcase error: getVersionInformation: "+(0,f.getErrorMessage)(e),p.LogLevel.Error)}this.mListLock?.release()}async handleDeleteFiles(e){null!==this.mCCCheckedoutGrp&&this.mCCUntrackedGrp&&(this.mCCCheckedoutGrp.resourceStates=this.mCCCheckedoutGrp.resourceStates.filter((t=>t.resourceUri.fsPath!==e.fsPath)),this.mCCUntrackedGrp.resourceStates=this.mCCUntrackedGrp.resourceStates.filter((t=>t.resourceUri.fsPath!==e.fsPath)))}async updateCheckedOutList(){let e=[];this.clearCase?.findCheckouts().then((t=>{e=t.map((e=>new n.CCScmResource(1,s.Uri.file(e),1))).sort(((e,t)=>e.resourceUri.fsPath.localeCompare(t.resourceUri.fsPath))),this.mCCCheckedoutGrp&&(this.mCCCheckedoutGrp.resourceStates=e.sort(((e,t)=>n.CCScmResource.sort(e,t)))),this.mIsUpdatingUntracked=!1}))}async createViewPrivateList(){let e=[];this.configHandler.configuration.showViewPrivateFiles.value&&(this.clearCase?.killUpdateFindViewPrivate(),this.clearCase?.findViewPrivate().then((t=>{e=t.map((e=>new n.CCScmResource(1,s.Uri.file(e),2))).sort(((e,t)=>e.resourceUri.fsPath.localeCompare(t.resourceUri.fsPath))),this.mCCUntrackedGrp&&(this.mCCUntrackedResource=e.sort(((e,t)=>n.CCScmResource.sort(e,t))),this.mCCUntrackedGrp.resourceStates=this.mCCUntrackedResource)})))}async createHijackedList(){let e=[];this.configHandler.configuration.showHijackedFiles.value&&(this.clearCase?.killUpdateFindHijacked(),this.clearCase?.findHijacked().then((t=>{e=t.map((e=>new n.CCScmResource(1,s.Uri.file(e),3))).sort(((e,t)=>e.resourceUri.fsPath.localeCompare(t.resourceUri.fsPath))),this.mCCHijackedGrp&&(this.mCCHijackedResource=e.sort(((e,t)=>n.CCScmResource.sort(e,t))),this.mCCHijackedGrp.resourceStates=this.mCCHijackedResource)})))}getCheckedoutObjects(){return this.mCCCheckedoutGrp?.resourceStates.map((e=>e.resourceUri.fsPath))}getUntrackedObjects(){return this.mCCUntrackedResource.map((e=>e.resourceUri.fsPath))}getHijackedObjects(){return this.mCCHijackedResource.map((e=>e.resourceUri.fsPath))}async commandUpdateUntrackedList(){!1===this.mIsUpdatingUntracked&&(this.mIsUpdatingUntracked=!0,await s.window.withProgress({location:s.ProgressLocation.SourceControl,title:"Search untracked files",cancellable:!1},(async e=>{await this.createViewPrivateList(),e.report({message:"Searching view private files completed",increment:100}),this.mIsUpdatingUntracked=!1})))}async commandUpdateHijackedFilesList(){!1===this.mIsUpdatingHijacked&&(this.mIsUpdatingHijacked=!0,await s.window.withProgress({location:s.ProgressLocation.SourceControl,title:"Search hijacked files",cancellable:!1},(async e=>{await this.createHijackedList(),e.report({message:"Searching hijacked files completed",increment:100}),this.mIsUpdatingHijacked=!1})))}deleteViewPrivateFile(e){const t={title:"Yes"};s.window.showInformationMessage(`Really delete file ${e.resourceUri.fsPath}?`,{modal:!0},t,{title:"No",isCloseAffordance:!0}).then((i=>{void 0!==i&&i.title===t.title&&(0,h.access)(e.resourceUri.fsPath,(t=>{void 0===t&&(0,h.unlink)(e.resourceUri.fsPath,(t=>{t&&this.outputChannel.appendLine(`Delete error: ${t.message}`,p.LogLevel.Error),this.handleDeleteFiles(e.resourceUri)}))}))}))}async editConfigSpec(){if(void 0===s.workspace.workspaceFolders)return;const e=s.workspace.workspaceFolders[0].uri.fsPath,t=s.window.showInformationMessage("Save Configspec?","Yes","No"),i=await(this.clearCase?.runClearTooledcs(e));t.then((e=>{let t="no";"Yes"===e&&(t="yes"),i?.stdin?.write(t),i?.stdin?.end()}))}get onWindowChanged(){return this.mWindowChangedEvent.event}bindCommands(){if(null!==this.clearCase){if(this.registerCommand("extension.ccExplorer",(e=>this.clearCase?.runClearCaseExplorer(e))),this.registerCommand("extension.ccCheckout",(e=>this.clearCase?.checkoutFileAction(e))),this.registerCommand("extension.ccCheckin",(e=>this.clearCase?.checkinFileAction(e))),this.registerCommand("extension.ccUndoCheckout",(e=>this.clearCase?.undoCheckoutFileAction(e))),this.registerCommand("extension.ccVersionTree",(e=>this.clearCase?.versionTree(e))),this.registerCommand("extension.ccComparePrevious",(e=>this.clearCase?.diffWithPrevious(e))),this.registerCommand("extension.ccItemProperties",(e=>this.clearCase?.itemProperties(e))),this.registerCommand("extension.ccMkElement",(e=>this.clearCase?.createVersionedObject(e))),this.registerCommand("extension.ccHijack",(e=>this.clearCase?.createHijackedObject(e))),this.registerCommand("extension.ccUndoHijack",(e=>this.clearCase?.cancelHijackedObject(e))),this.registerCommand("extension.ccCompareWithVersion",(e=>this.selectVersionAndCompare(e))),this.mDisposables.push(s.commands.registerCommand("extension.ccOpenResource",(e=>{let t=null;e instanceof s.Uri&&(t=e),e instanceof n.CCScmResource&&(t=e.resourceUri),null===t&&s.window?.activeTextEditor&&(t=s.window.activeTextEditor.document.uri),null!==t&&!1===(0,h.statSync)(t.fsPath).isDirectory()&&this.openResource(t)}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccEmbedDiff",(e=>{this.embeddedDiff(e)}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccFindModified",(()=>{if(s.workspace.workspaceFolders){const e=s.workspace.workspaceFolders[0].uri.fsPath;e&&this.clearCase?.findModified(e)}}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccFindCheckouts",(()=>{if(s.workspace.workspaceFolders){const e=s.workspace.workspaceFolders[0].uri.fsPath;e&&this.clearCase?.findCheckoutsGui(e)}}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccFindViewPrivate",(()=>{this.clearCase?.findViewPrivate()}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccUpdateView",(()=>{this.clearCase?.updateView()}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccUpdateDir",(e=>{s.window.activeTextEditor?.document&&e&&this.clearCase?.updateDir(e)}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccUpdateFile",(e=>{s.window.activeTextEditor?.document&&e&&this.clearCase?.updateFile(e)}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccSelectActv",(()=>{this.clearCase?.changeCurrentActivity()}),this)),void 0!==s.window.activeTextEditor){const e=new a.CCAnnotationController(s.window.activeTextEditor,this.configHandler);this.mDisposables.push(e),this.mDisposables.push(s.commands.registerCommand("extension.ccAnnotate",(t=>{s.window.activeTextEditor?.document&&this.clearCase?.annotate(t??s.window.activeTextEditor.document.uri,e)}),this))}this.mDisposables.push(s.languages.registerCodeLensProvider(c.CCCodeLensProvider.selector,new c.CCCodeLensProvider(this.configHandler,this)))}}registerCommand(e,t){this.mDisposables.push(s.commands.registerCommand(e,((e,i)=>{let o=null;e instanceof s.Uri&&(o=e),e instanceof n.CCScmResource&&(o=e.resourceUri),null===o&&s.window.activeTextEditor&&(o=s.window.activeTextEditor.document.uri);let r=[];i&&i?.length>0?r=i.map((e=>e instanceof s.Uri?e:e instanceof n.CCScmResource?e.resourceUri:s.Uri.parse(""))):null!==o&&r.push(o),r.length>0&&t(r)}),this))}bindScmCommand(){this.mDisposables.push(s.commands.registerCommand("extension.ccCheckinAll",(()=>{s.window.withProgress({location:s.ProgressLocation.SourceControl,title:"Checkin all files",cancellable:!1},(async e=>{const t=this.mCCCheckedoutGrp?.resourceStates.map((e=>e.resourceUri))??[];if(null!==this.mCCScm){const i=this.mCCScm.inputBox.value||"";await(this.clearCase?.checkinFiles(t,i)),this.mCCScm.inputBox.value="",this.updateCheckedOutList(),e.report({message:"Checkin finished."})}}))}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccCheckinSelected",((...e)=>{s.window.withProgress({location:s.ProgressLocation.SourceControl,title:"Checkin all files",cancellable:!1},(async t=>{const i=e?.map((e=>e.resourceUri))??[];if(null!==this.mCCScm){const e=this.mCCScm.inputBox.value||"";await(this.clearCase?.checkinFiles(i,e)),this.mCCScm.inputBox.value="",this.updateCheckedOutList(),t.report({message:"Checkin finished."})}}))}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccRefreshFileList",(()=>{this.updateCheckedOutList()}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccRefreshViewPrivateFileList",(()=>{this.commandUpdateUntrackedList()}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccRefreshHijackedFileList",(()=>{this.commandUpdateHijackedFilesList()}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccDeleteViewPrivate",(e=>{this.deleteViewPrivateFile(e)}),this)),this.mDisposables.push(s.commands.registerCommand("extension.ccEditConfigSpec",(()=>{this.editConfigSpec()}),this))}bindEvents(){this.mDisposables.push(s.workspace.onWillSaveTextDocument((e=>this.onWillSaveDocument(e)))),this.mDisposables.push(s.window.onDidChangeActiveTextEditor((e=>{this.outputChannel.appendLine("onDidChangeActiveTextEditor",p.LogLevel.Trace),this.onDidChangeTextEditor(e)}))),this.mDisposables.push(s.window.onDidChangeWindowState((e=>{e.focused&&(this.outputChannel.appendLine("OnDidChangeWindowState",p.LogLevel.Trace),this.onDidChangeTextEditor(s.window.activeTextEditor))})))}async onWillSaveDocument(e){try{if(null===e?.document||e.document.isUntitled||e.reason!==s.TextDocumentSaveReason.Manual)return;if(this.clearCase?.isReadOnly(e.document))this.configHandler.configuration.useClearDlg.value?this.clearCase.checkoutAndSaveFile(e.document):this.clearCase.isClearcaseObject(e.document.uri).then((t=>{!0===t&&this.clearCase?.checkoutFile([e.document.uri]).then((t=>{!0===t&&e.document.save()})).catch((()=>{}))}));else{let t;try{t=await(this.clearCase?.getVersionInformation(e.document.uri))??new C.CCVersionType}catch(e){this.outputChannel.appendLine("Clearcase error: getVersionInformation: "+(0,f.getErrorMessage)(e),p.LogLevel.Error)}""===t?.version&&this.handleChangeFiles([e.document.uri])}}catch(e){console.log("error "+(0,f.getErrorMessage)(e))}}async openResource(e){if(s.window){const t=await s.workspace.openTextDocument(e);s.window.showTextDocument(t)}}async embeddedDiff(e,t){if(s.window){const i={preview:!0};t&&(e=e.with({fragment:t}));const n=await(this.mCCContentProvider?.getOriginalResource(e));if(void 0!==n){const t=m.basename(e.fsPath),{version:o}=(0,u.fromCcUri)(n);s.commands.executeCommand("vscode.diff",n,e,`${t}@${o} <=> Current Version`,i)}}}async updateHijackedList(e,t){if(this.clearCase&&this.mCCHijackedGrp){const i=1===t.state;let s=!1;const o=this.mCCHijackedResource.filter((t=>t.resourceUri.fsPath!==e.fsPath||(s=!0,i)))??[];return i&&(!1===this.clearCase.hijackedList.exists(e.fsPath)&&(this.clearCase.hijackedList.addString(e.fsPath),this.mContext.workspaceState.update("hijackedfilecache",this.clearCase.hijackedList.stringify())),s||o.push(new n.CCScmResource(1,e,3))),this.mCCHijackedResource=[...o],this.updateHijackedResourceGroup(),!0}return!1}async updateViewPrivateList(e,t){if(this.clearCase&&this.mCCUntrackedGrp){const i=2===t.state;let s=!1;const o=this.mCCUntrackedResource.filter((t=>t.resourceUri.fsPath!==e.fsPath||(s=!0,i)))??[];return i&&(!1===this.clearCase.untrackedList.exists(e.fsPath)&&(this.clearCase.untrackedList.addString(e.fsPath),this.mContext.workspaceState.update("untrackedfilecache",this.clearCase.untrackedList.stringify())),s||o.push(new n.CCScmResource(1,e,2))),this.mCCUntrackedResource=[...o],this.updateUntrackedResourceGroup(),!0}return!1}updateUntrackedResourceGroup(){this.mCCUntrackedGrp&&(this.configHandler.configuration.showViewPrivateFiles.value?this.mCCUntrackedGrp.resourceStates=this.mCCUntrackedResource.sort(((e,t)=>n.CCScmResource.sort(e,t)))||[]:(this.mCCUntrackedGrp.resourceStates=[],this.clearCase?.killUpdateFindViewPrivate()))}updateHijackedResourceGroup(){this.mCCHijackedGrp&&(this.configHandler.configuration.showHijackedFiles.value?this.mCCHijackedGrp.resourceStates=this.mCCHijackedResource.sort(((e,t)=>n.CCScmResource.sort(e,t)))||[]:(this.mCCHijackedGrp.resourceStates=[],this.clearCase?.killUpdateFindHijacked()))}async onDidChangeTextEditor(e){if(this.mCCContentProvider?.resetCache(),this.updateCheckedOutList(),e&&this.clearCase&&"output"!==e?.document.uri.scheme){const t=await(this.clearCase?.getVersionInformation(e?.document.uri,!0));this.updateHijackedList(e?.document.uri,t),this.updateViewPrivateList(e.document.uri,t)}"output"!==e?.document.uri.scheme&&this.mWindowChangedEvent.fire(void 0!==e)}async selectVersionAndCompare(e){if(this.clearCase&&e.length>0){const t=await g.default.showVersionSelectQuickpick(this.clearCase.getVersionsOfFile(e[0]));void 0!==t&&""!==t&&this.embeddedDiff(e[0],t)}}get version(){return this.mVersion}dispose(){this.mDisposables.forEach((e=>e.dispose())),this.mDisposables=[]}}},259:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCScmResource=void 0;const s=i(398),n=i(928),o=n.join(n.dirname(__dirname),"Assets","icons");function r(e,t){return s.Uri.file(n.join(o,t,`${e}.svg`))}t.CCScmResource=class{get resourceUri(){return this.mResourceUri}get command(){return{command:"extension.ccEmbedDiff",title:"compare to previous",arguments:[this.resourceUri]}}constructor(e,t,i){this.mResourceGrpType=e,this.mResourceUri=t,this.mType=i}get type(){return this.mType}get letter(){switch(this.type){case 1:return"M";case 2:return"U";case 3:return"H"}}get tooltip(){switch(this.type){case 1:return"modified";case 2:return"untracked";case 3:return"hijacked"}}get color(){switch(this.type){case 1:return new s.ThemeColor("ccDecoration.modifiedResourceForeground");case 2:return new s.ThemeColor("ccDecoration.untrackedResourceForeground");case 3:return new s.ThemeColor("ccDecoration.hijackedResourceForeground")}}get decorations(){const e=this.tooltip,t={iconPath:this.getIcon("dark")};return{strikeThrough:!1,faded:!1,tooltip:e,light:{iconPath:this.getIcon("light")},dark:t}}getIcon(e){switch(e){case"dark":case"light":switch(this.mType){case 2:return r("status-untracked",e);case 1:return r("status-modified",e);case 3:return r("status-hijacked",e)}}return s.Uri.file("")}static sort(e,t){return e.resourceUri.fsPath<t.resourceUri.fsPath?-1:e.resourceUri.fsPath>t.resourceUri.fsPath?1:0}}},613:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(398);t.default=class{static async showCreateLabelInput(){return await s.window.showInputBox({ignoreFocusOut:!0,title:"Set a label after checkin"})??""}static async showCommentInput(){return await s.window.showInputBox({ignoreFocusOut:!0,prompt:"Checkin comment"})??""}static async showCleartoolMsgBox(){const e=[{title:"Yes"},{title:"No"}],t=await s.window.showInformationMessage("Do you want to checkin the current file?",...e);return t?.title===e[0].title}static showInformationMessage(e){s.window.showInformationMessage(e)}static showErrorMessage(e){s.window.showErrorMessage(e)}static async showVersionSelectQuickpick(e){return await s.window.showQuickPick(e,{ignoreFocusOut:!0,canPickMany:!1,title:"Select a version"})??""}}},916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCVersionType=void 0,t.CCVersionType=class{constructor(e,t){this.mVersion="",this.mState=2,this.mVersion=e??"",this.mState=t??2}set state(e){this.mState=e}get state(){return this.mState}set version(e){this.mVersion=e}get version(){return this.mVersion}}},453:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClearCase=t.Cleartool=t.CCArgs=t.ViewType=t.EventArgs=t.EventActions=void 0;const s=i(317),n=i(896),o=i(857),r=i(928),a=i(83),c=i(398),l=i(767),h=i(5),d=i(916),u=i(613),m=i(694);var f,C;(C=t.EventActions||(t.EventActions={}))[C.Add=0]="Add",C[C.Remove=1]="Remove",t.EventArgs=class{},function(e){e[e.Unknown=0]="Unknown",e[e.Dynamic=1]="Dynamic",e[e.Snapshot=2]="Snapshot",e[e.Webview=3]="Webview"}(f=t.ViewType||(t.ViewType={}));class p{constructor(e,t,i){this.params=[],this.mFiles=[],this.params=[...e],t&&t.length>0&&(this.mFiles=[...t]),this.mVersion=i}toString(){return this.params.reduce(((e,t)=>`${e} ${t}`))+` ${this.mFiles}`}getCmd(){return void 0!==this.mFiles&&void 0===this.mVersion?[...this.params,...this.mFiles]:void 0!==this.mFiles&&void 0!==this.mVersion&&""!==this.mVersion?[...this.params,`${this.mFiles[0]}@@${this.mVersion}`]:this.params}get files(){return this.mFiles}set files(e){this.mFiles=[...e]}set file(e){this.mFiles.push(e)}}t.CCArgs=p;class g{constructor(e="",t="",i="",s=""){this.mAddress=i,this.mPassword=t,this.mUsername=e,this.mExecutable="",""!==s?this.executable(s):this.executable("cleartool")}executable(e){return void 0!==e&&(this.mExecutable=e),this.mExecutable}credentials(){return""!==this.mAddress?["-lname",this.mUsername,"-password",this.mPassword,"-server",this.mAddress]:[]}}t.Cleartool=g,t.ClearCase=class{constructor(e,t){this.configHandler=e,this.outputChannel=t,this.lsView=["lsview","-cview","-long"],this.rxViewType=new RegExp("\\.(vws|stg)$","i"),this.rxViewAttr=new RegExp("(view attributes\\:)\\s*(snapshot)","i"),this.mIsCCView=!1,this.mIsWslEnv=!1,this.mViewType=f.Unknown,this.mUpdateEvent=new c.EventEmitter,this.mUntrackedList=new h.MappedList,this.mHijackedList=new h.MappedList,this.mWebviewPassword="",this.mRunningCommands=new Map,!0===this.configHandler.configuration.useRemoteClient.value?this.mExecCmd=new g(this.configHandler.configuration.webserverUsername.value,this.mWebviewPassword,this.configHandler.configuration.webserverAddress.value,this.configHandler.configuration.executable.value):this.mExecCmd=new g("","","",this.configHandler.configuration.executable.value),this.configHandler.onDidChangeConfiguration((e=>{const t=e.find((e=>"useRemoteClient"===e)),i=e.find((e=>"cleartoolExecutable"===e));void 0!==t&&c.window.showWarningMessage("The usewebview config date has changed! Please reload window to set changes active."),void 0!==i&&this.mExecCmd.executable(this.configHandler.configuration.executable.value)}))}get isView(){return this.mIsCCView}get viewType(){return this.mViewType}get onCommandExecuted(){return this.mUpdateEvent.event}get untrackedList(){return this.mUntrackedList}get hijackedList(){return this.mHijackedList}set password(e){this.mWebviewPassword=e,!0===this.configHandler.configuration.useRemoteClient.value&&(this.mExecCmd=new g(this.configHandler.configuration.webserverUsername.value,this.mWebviewPassword,this.configHandler.configuration.webserverAddress.value,this.configHandler.configuration.executable.value))}async checkIsView(e){let t=!1;if(void 0!==e?.document)try{t=await this.isClearcaseObject(e.document.uri)}catch{t=!1}return t||(t=await this.hasConfigspec()),t&&(this.mViewType=await this.detectViewType()),this.mIsCCView=t,t}async detectIsWsl(){if(this.mIsWslEnv=!1,"Windows_NT"===(0,o.type)())return!1;try{n.accessSync("/usr/bin/wslpath",n.constants.R_OK)}catch{return!1}return this.mIsWslEnv=!0,!0}async loginWebview(){try{const e=new p(["login"].concat(this.mExecCmd.credentials())),t=void 0!==c.workspace.workspaceFolders?c.workspace.workspaceFolders[0].uri.fsPath:"";await this.runCleartoolCommand("loginWebview",e,t,(e=>(this.outputChannel.appendLine(e.join(" "),m.LogLevel.Information),!0)))}catch(e){this.outputChannel.append(`Error while login ${e}`,m.LogLevel.Error)}return!1}async execOnSCMFile(e,t){await this.runCleartoolCommand("execOnScmFile",new p(["ls"],[e[0]?.fsPath]),(0,r.dirname)(e[0]?.fsPath),null,((i,s,n)=>{0!==i||n.length>0?c.window.showErrorMessage(`${e[0]?.fsPath} is not a valid ClearCase object.`):t(e)}))}runClearCaseExplorer(e){(0,s.exec)('clearexplorer "'+e[0]?.fsPath+'"')}async checkoutFileAction(e){if(this.configHandler.configuration.useClearDlg.value){for(const t of e){if("Windows_NT"===(0,o.type)())return(0,s.exec)(`cleardlg /checkout ${t.fsPath}`,(()=>this.mUpdateEvent.fire([t]))),!0;{const e=[{title:"Yes"},{title:"No"}],i=await c.window.showInformationMessage("Do you want to checkout the current file?",...e);switch(i?.title){case e[0].title:return await this.checkoutFile([t]);case e[1].title:}}}return!0}return await this.checkoutFile(e)}async checkoutFile(e){const t=this.configHandler.configuration.checkoutCommand.value,i=this.configHandler.configuration.defaultComment.value;let s="";const n=t.trim().split(/\s+/);let o=n.indexOf("${comment}");if(o>-1)s=i||(await c.window.showInputBox({ignoreFocusOut:!0,prompt:"Checkout comment"})??""),n[o]=s;else{let e=n.indexOf("-comment");e>-1&&n.splice(e,1),e=n.indexOf("-c"),e>-1&&n.splice(e,1),e=n.indexOf("-nc"),-1===e&&n.push("-nc")}t.includes("usehijack")||this.viewType!==f.Snapshot||n.splice(0,0,"-usehijack");const a=new p(["co"]);a.params=a.params.concat(n),o=a.params.indexOf("${filename}"),o>-1&&(1===e.length?a.params[o]=this.wslPath(e[0]?.fsPath,!1):a.params[o]=""),(e.length>1||-1===o)&&(a.files=e.map((e=>this.wslPath(e.fsPath,!1))));try{await this.runCleartoolCommand("checkoutFile",a,(0,r.dirname)(e[0]?.fsPath),null,(()=>this.mUpdateEvent.fire(e)))}catch(e){return this.outputChannel.appendLine("Clearcase error: runCleartoolCommand: "+(0,l.getErrorMessage)(e),m.LogLevel.Error),c.window.showErrorMessage(`${(0,l.getErrorMessage)(e)}`,{modal:!1}),!1}return!0}async checkoutAndSaveFile(e){const t=e.fileName;if("Windows_NT"===(0,o.type)())(0,s.exec)('cleardlg /checkout "'+t+'"',(async()=>{if(!1===this.isReadOnly(e))try{await e.save(),this.mUpdateEvent.fire([e.uri])}catch{}else c.window.showErrorMessage("Could not save file.")}));else{const t=[{title:"Yes"},{title:"No"}],i=await c.window.showInformationMessage("Do you want to checkout the current file?",...t);switch(i?.title){case t[0].title:await this.checkoutFile([e.uri]),await e.save();case t[1].title:}}}async undoCheckoutFileAction(e){if(this.configHandler.configuration.useClearDlg.value)for(const t of e)if("Windows_NT"===(0,o.type)())(0,s.exec)(`cleardlg /uncheckout ${t.fsPath}`,(()=>this.mUpdateEvent.fire([t])));else{const e=[{title:"Yes"},{title:"No"}],i=await c.window.showInformationMessage("Do you want to undo checkout the current file?",...e);switch(i?.title){case e[0].title:await this.undoCheckoutFile([t]);case e[1].title:}}else await this.undoCheckoutFile(e)}async undoCheckoutFile(e){let t="-rm";this.configHandler.configuration.uncoKeepFile.value&&(t="-keep");const i=e.map((e=>this.wslPath(e.fsPath,!1)));await this.runCleartoolCommand("undoCheckoutFile",new p(["unco",t],i),(0,r.dirname)(e[0]?.fsPath),null,(()=>this.mUpdateEvent.fire(e)))}async createVersionedObject(e){const t=e.map((e=>this.wslPath(e.fsPath,!1)));try{await this.runCleartoolCommand("createVersionedObject",new p(["mkelem","-mkp","-nc"],t),(0,r.dirname)(e[0]?.fsPath),null,(()=>this.mUpdateEvent.fire(e)))}catch(e){c.window.showErrorMessage(`${(0,l.getErrorMessage)(e)}`,{modal:!1})}}async createHijackedObject(e){if(this.mViewType===f.Snapshot){for(const t of e){n.chmodSync(t.fsPath,511);const e=new Date;n.utimesSync(t.fsPath,e,e)}this.mUpdateEvent.fire(e)}}async cancelHijackedObject(e){if(this.mViewType===f.Snapshot)for(const t of e)await this.runCleartoolCommand("cancelHijacked",new p(["update","-overwrite"],[t.fsPath]),(0,r.dirname)(t.fsPath),null,(()=>this.mUpdateEvent.fire([t])))}async checkinFileAction(e){if(this.configHandler.configuration.useClearDlg.value)for(const t of e)"Windows_NT"===(0,o.type)()?(0,s.exec)(`cleardlg /checkin ${t.fsPath}`,(()=>this.mUpdateEvent.fire([t]))):!0===await u.default.showCleartoolMsgBox()&&this.checkinFile([t]);else await this.checkinFile(e)}async checkinFile(e){const t=this.configHandler.configuration.defaultComment.value,i=new p(["ci"]);await this.doCheckinFiles(await this.prepareCheckinParams(t,e,!1,i),e)}async checkinFiles(e,t){const i=new p(["ci"]);await this.doCheckinFiles(await this.prepareCheckinParams(t,e,!0,i),e)}async prepareCheckinParams(e,t,i,s){let n=!1;if(i)""!==e?(s.params.push("-c"),s.params.push(e)):s.params.push("-nc"),n=!0;else{const i=this.configHandler.configuration.checkinCommand.value.trim().split(/\s+/);let o="",r=i.indexOf("${comment}");if(r>-1)o=e||(await c.window.showInputBox({ignoreFocusOut:!0,prompt:"Checkin comment"})??""),i[r]=o;else{let e=i.indexOf("-comment");e>-1&&i.splice(e,1),e=i.indexOf("-c"),e>-1&&i.splice(e,1),e=i.indexOf("-nc"),-1===e&&i.push("-nc")}s.params=s.params.concat(i),r=s.params.indexOf("${filename}"),r>-1&&(1===t.length?s.params[r]=this.wslPath(t[0]?.fsPath,!1):s.params[r]=""),(t.length>1||-1===r)&&(n=!0)}return n&&(s.files=t.map((e=>this.wslPath(e.fsPath,!1)))),s}async doCheckinFiles(e,t){if(await this.runCleartoolCommand("checkinFiles",e,(0,r.dirname)(t[0]?.fsPath),null,(()=>this.mUpdateEvent.fire(t))),this.configHandler.configuration.useLabelAtCheckin.value){const e=await u.default.showCreateLabelInput();if(""!==e)for(const i of t)await this.createLabelType(i,e),await this.applyLabel(i,e)}}versionTree(e){for(const t of e)this.runCleartoolCommand("versionTree",new p(["lsvtree","-graphical"],[t.fsPath]),(0,r.dirname)(t.fsPath),null)}diffWithPrevious(e){for(const t of e)this.runCleartoolCommand("diffWithPrevious",new p(["diff","-graph","-pred"],[t.fsPath]),(0,r.dirname)(t.fsPath),null)}async findCheckouts(){const e=this.configHandler.configuration.findCheckoutsCommand.value;let t=[],i="";void 0!==c.workspace.workspaceFolders&&c.workspace.workspaceFolders.length>0&&(i=c.workspace.workspaceFolders[0].uri.fsPath);try{const s=this.isRunningInWsl(),n=e.split(" "),r=new p(["lsco",...n]);await this.runCleartoolCommand("findCheckouts",r,i,null,((e,n)=>{if(n.length>0){const e=n.trim().split(/\r\n|\r|\n/);t=e.map((e=>(e.startsWith("\\")&&"Windows_NT"===(0,o.type)()&&(e=e.replace("\\",i.toUpperCase()[0]+":\\")),!0===s&&(e=e.replace(/\\/g,"/").replace(/^([A-Za-z]):/,((e,t)=>`/mnt/${t.toLowerCase()}`))),e)))}}))}catch(e){this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Error),c.window.showErrorMessage(`${(0,l.getErrorMessage)(e)}`,{modal:!1})}return t}async findViewPrivate(){const e=this.configHandler.configuration.findViewPrivateCommand.value;let t=[],i="";void 0!==c.workspace.workspaceFolders&&c.workspace.workspaceFolders.length>0&&(i=c.workspace.workspaceFolders[0].uri.fsPath);try{const s=this.isRunningInWsl(),n=e.split(" "),r=new p([...n]);await this.runCleartoolCommand("findViewPrivate",r,i,null,((e,n)=>{if(n.length>0){const e=this.configHandler.configuration.viewPrivateFileSuffixes.value,r=new RegExp(e,"i"),a=n.trim().split(/\r\n|\r|\n/);t=a.filter((e=>null!==e.match(r))).map((e=>(e.startsWith("\\")&&"Windows_NT"===(0,o.type)()&&(e=e.replace("\\",i.toUpperCase()[0]+":\\")),!0===s&&(e=e.replace(/\\/g,"/").replace(/^([A-Za-z]):/,((e,t)=>`/mnt/${t.toLowerCase()}`))),e)))}}))}catch(e){this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Error),c.window.showErrorMessage(`${(0,l.getErrorMessage)(e)}`,{modal:!1})}return t}async findHijacked(){const e=this.configHandler.configuration.findHijackedCommand.value;let t=[],i="";void 0!==c.workspace.workspaceFolders&&c.workspace.workspaceFolders.length>0&&(i=c.workspace.workspaceFolders[0].uri.fsPath);try{const s=this.isRunningInWsl(),n=e.split(" "),r=new p([...n]);await this.runCleartoolCommand("findHijacked",r,i,null,((e,n)=>{if(n.length>0){const e=n.trim().split(/\r\n|\r|\n/);t=e.filter((e=>null!==e.match(/hijacked/i))).map((e=>{e.startsWith("\\")&&"Windows_NT"===(0,o.type)()&&(e=e.replace("\\",i.toUpperCase()[0]+":\\")),!0===s&&(e=e.replace(/\\/g,"/").replace(/^([A-Za-z]):/,((e,t)=>`/mnt/${t.toLowerCase()}`)));const t=e.indexOf("@@");return t>-1&&(e=e.substring(0,t)),e}))}}))}catch(e){this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Error),c.window.showErrorMessage(`${(0,l.getErrorMessage)(e)}`,{modal:!1})}return t}findCheckoutsGui(e){(0,s.exec)('clearfindco "'+e+'"')}findModified(e){(0,s.exec)('clearviewupdate -pname "'+e+'" -modified')}updateView(){(0,s.exec)("clearviewupdate")}async hasConfigspec(){let e=!1;if(void 0!==c.workspace.workspaceFolders&&c.workspace.workspaceFolders.length>0)try{for(const t of c.workspace.workspaceFolders){const i=new p(["catcs"]);if(await this.runCleartoolCommand("hasConfigspec",i,t.uri.fsPath,null,((t,i,s)=>{e=0===t&&0===s.length})),!1!==e)break}}catch{e=!1}return e}async isClearcaseObject(e){try{return 2!==(await this.getVersionInformation(e)).state}catch{return!1}}async getVersionInformation(e,t=!0){let i=new d.CCVersionType;if(void 0!==e&&!0===this.isView){const s=(0,r.dirname)(e.fsPath);await this.runCleartoolCommand("getVersionInformation",new p(["ls"],[e.fsPath]),s,null,((e,s,n)=>{0===e&&0===n.length&&(i=this.getVersionString(s,t))}))}return i}getVersionString(e,t){const i=new d.CCVersionType("not in a VOB");if(null!=e&&""!==e){const s=e.match(/(((\S+)@@(\S+)(\s+\[hijacked\]){0,1}(.*){0,1})|(\S+))/i);s&&(s.length>0&&void 0!==s[5]?(i.version=s[4],i.state=1):s.length>0&&void 0!==s[3]&&void 0!==s[4]?(i.version=t?s[4].replace(/\\/g,"/").trim():s[4].trim(),i.state=0):s.length>0&&void 0!==s[7]&&(i.version="view private",i.state=2))}return i}async updateDir(e){try{const t=await this.updateObject(e,0);u.default.showInformationMessage(`Update of ${t} finished!`)}catch(e){u.default.showErrorMessage((0,l.getErrorMessage)(e))}}async updateFile(e){try{const t=await this.updateObject(e,1);u.default.showInformationMessage(`Update of ${t} finished!`)}catch(e){u.default.showErrorMessage((0,l.getErrorMessage)(e))}}async updateObject(e,t){let i="";if(void 0!==c.window.activeTextEditor){const s=null===e?.fsPath?c.window.activeTextEditor.document.fileName:e.fsPath,o=n.lstatSync(s);let a="",l="";o.isDirectory()?(a=s,l=s):o.isFile()&&(l=a=(0,r.dirname)(s),1===t&&(a=s));let h="";if(await this.runCleartoolCommand("updateObject",new p(["update"],[a]),l,(()=>this.mUpdateEvent.fire([e])),((e,t,s)=>{h=s,i=t})),h.length>0)throw new Error(h)}return i}itemProperties(e){for(const t of e)(0,s.exec)(`cleardescribe ${t.fsPath}`)}async annotate(e,t){try{const i=await this.getAnnotatedFileContent(e.fsPath);t.setAnnotationInText(i)}catch(e){const t=(0,l.getErrorMessage)(e).replace(/[\r\n]+/g," ");u.default.showErrorMessage(t)}}async getAnnotatedFileContent(e){let t="";if(void 0!==c.workspace.workspaceFolders){let i="";const s=this.configHandler.configuration.annotationFormatString.value,n=" | ",o=this.wslPath(e,!1);if(await this.runCleartoolCommand("getAnnotationFileContent",new p(["annotate","-out","-","-nhe","-fmt",`"${s}${n}"`,`${o}`]),c.workspace.workspaceFolders[0].uri.fsPath,null,((e,s,n)=>{i=n,t=s})),i.length>0)throw new Error(i)}return t}isReadOnly(e){const t=e.fileName;try{return n.accessSync(t,n.constants.W_OK),!1}catch{return!0}}async getCurrentActivity(){let e="";if(void 0!==c.workspace.workspaceFolders){let t="";if(await this.runCleartoolCommand("getCurrentActivity",new p(["lsactivity","-cac","-fmt",'"%n"']),c.workspace.workspaceFolders[0].uri.fsPath,null,((i,s,n)=>{t=n,e=s})),t.length>0)throw new Error(t)}return e}async getQuickPickActivities(e){const t=[];if(void 0!==c.workspace.workspaceFolders){let i="";if(await this.runCleartoolCommand("getQuickPickActivities",new p(["lsactivity"]),c.workspace.workspaceFolders[0].uri.fsPath,null,((s,n,o)=>{i=o;const r=n.split(/[\n\r]+/);for(const i of r){const s=i.split(" ");if(s.length>=7){const i=s[2];let n=s.slice(7).join(" ");n=i===e?"✓ "+n:"☐ "+n,t.push({label:n,description:"",detail:i})}}})),i.length>0)throw new Error(i)}return t}async changeCurrentActivity(){try{const e=await this.getCurrentActivity(),t=await c.window.showQuickPick(this.getQuickPickActivities(e));t&&(e===t.detail?this.setViewActivity(void 0):this.setViewActivity(t.detail))}catch(e){const t=(0,l.getErrorMessage)(e).replace(/[\r\n]+/g," ");c.window.showErrorMessage(t)}}async setViewActivity(e){let t="";if(void 0!==c.workspace.workspaceFolders){let i="",s="-none";if(void 0!==e&&(s=e),await this.runCleartoolCommand("setViewActivities",new p(["setactivity",`${s}`]),c.workspace.workspaceFolders[0].uri.fsPath,null,((e,s,n)=>{i=n,t=s})),i.length>0)throw new Error(i)}return t}async getFilePredecessorVersion(e){const t=new d.CCVersionType;return""!==e&&await this.runCleartoolCommand("getFilePredecessorVersion",new p(["describe","-fmt","%[version_predecessor]p",e]),(0,r.dirname)(e),null,((e,i)=>{t.version=i})),t}async readFileAtVersion(e,t){let i,s=this.configHandler.configuration.tempDir.value,o="";!0===this.isRunningInWsl()?(s=this.wslPath(s,!0),o=a.tmpNameSync({tmpdir:s}),i=c.Uri.file(o),o=this.wslPath(o,!1)):(o=a.tmpNameSync({tmpdir:s}),i=c.Uri.file(o)),void 0!==c.workspace.workspaceFolders&&await this.runCleartoolCommand("readFileAtVersion",new p(["get","-to",o],[e],t),c.workspace.workspaceFolders[0].uri.fsPath,null,((e,t)=>{console.log(t)}));const r=""!==this.configHandler.configuration.diffViewEncoding.value?this.configHandler.configuration.diffViewEncoding.value:"utf8";return n.readFileSync(i.fsPath,{encoding:r})}async runCleartoolCommand(e,t,i,o,r){const a=this.mExecCmd.executable();try{n.accessSync(i,n.constants.F_OK)}catch{return this.outputChannel.appendLine(`CWD (${i}) not found`,m.LogLevel.Warning),Promise.reject()}t.files=t.files.map((e=>this.wslPath(e,!1))),this.outputChannel.appendLine(t.getCmd().toString(),m.LogLevel.Debug);const c=(0,s.spawn)(a,t.getCmd(),{cwd:i,env:process.env,detached:!0});this.killRunningCommand(e,c.pid),this.mRunningCommands.set(e,c),this.outputChannel.appendLine(`Command ${e} (${c.pid}) started`,m.LogLevel.Trace);let l=Buffer.alloc(0),h="";return new Promise(((t,i)=>{c.stdout.on("data",(e=>{let t="";Buffer.isBuffer(e)&&(l=Buffer.concat([l,e],l.length+e.length),t=e.toString()),null!==o&&"function"==typeof o&&o(t.split(/\r\n|\r|\n/).filter((e=>e.length>0)))})),c.stderr.on("data",(e=>{let t="";Buffer.isBuffer(e)&&(t=e.toString()),h=`${h}${t}`})),c.on("close",((s,n)=>{this.outputChannel.appendLine(`Command ${e} (${c.pid}), with Signal (${n}) deleted`,m.LogLevel.Trace),this.mRunningCommands.has(e)&&(this.mRunningCommands.get(e)?.pid===c.pid&&(this.mRunningCommands.delete(e),this.outputChannel.appendLine(`Command ${e} (${c.pid}) deleted`,m.LogLevel.Trace)),this.outputChannel.appendLine(`Command ${e} (${c.pid}) finished`,m.LogLevel.Trace)),""!==h?this.outputChannel.appendLine(`exit code ${s}, stderr: ${h}`,m.LogLevel.Error):this.outputChannel.appendLine(`${l.toString()}`,m.LogLevel.Debug),null!==s&&0!==s&&this.isView&&""!==h&&i(h),"SIGKILL"!==n&&"function"==typeof r&&r(s,l.toString(),h),t(void 0)}))}))}async killRunningCommand(e,t){if(this.mRunningCommands.has(e)){const i=this.mRunningCommands.get(e);if(i&&(i.pid===t||0===t)){const t=i.pid;this.outputChannel.appendLine(`Going to kill ${e} (${t})`,m.LogLevel.Trace),"win32"===process.platform?(0,s.exec)(`taskkill /PID ${t} /T /F`):process.kill(-t,"SIGKILL"),this.outputChannel.appendLine(`Command ${e} (${t}) killed`,m.LogLevel.Trace),this.mRunningCommands.delete(e),this.outputChannel.appendLine(`Command ${e} (${t}) deleted`,m.LogLevel.Trace)}}}killUpdateFindViewPrivate(){this.killRunningCommand("findViewPrivate",0)}killUpdateFindHijacked(){this.killRunningCommand("findHijacked",0)}async detectViewType(){let e=[],t=f.Unknown;const i=e=>0!==e.length&&(e.match(/view uuid: ([\w.:]+)/gi)??e.match(/view attributes:\s+snapshot/gi));return void 0!==c.workspace.workspaceFolders&&await this.runCleartoolCommand("detectViewType",new p(this.lsView),c.workspace.workspaceFolders[0].uri.fsPath,null,((s,n)=>{e=n.split(/\r\n|\r|\n/).filter((e=>e.length>0));const o=e.filter(i);0!==o.length&&(o.length>1&&o[1].match(/View attributes: snapshot/)?(t=f.Snapshot,o.length>1&&o[1].match(/webview/i)&&(t=f.Webview)):t=f.Dynamic)})),t}isRunningInWsl(){return this.mIsWslEnv}async runClearTooledcs(e){const t=this.configHandler.configuration.executable.value;process.env.VISUAL="code -r";const i={cwd:e,env:process.env};return new Promise(((e,n)=>{e((0,s.exec)(`${t} edcs`,i,((e,t,i)=>{(e||i)&&(e?(this.outputChannel.appendLine(`cleartool edcs error: ${e.message}`,m.LogLevel.Error),n(e.message)):(this.outputChannel.appendLine(`cleartool edcs stderr: ${i}`,m.LogLevel.Error),n(i)))})))}))}wslPath(e,t=!0){const i=this.getMappedPath(e,t);return this.isRunningInWsl()?!0===t?i.replace(/\\/g,"/"):i.replace(/\//g,"\\"):e}getMappedPath(e,t){if(this.isRunningInWsl()){if(!(this.configHandler.configuration.pathMapping.value.length>0))return!0===t?e.replace(/^([A-Za-z]):/,((e,t)=>`/mnt/${t.toLowerCase()}`)):e.replace(/^\/mnt\/([A-Za-z])/,"$1:");for(const i of this.configHandler.configuration.pathMapping.value)if(!1===t){if(e.startsWith(i.wsl))return e.replace(i.wsl,i.host)}else if(e.startsWith(i.host))return e.replace(i.host,i.wsl)}return e}checkIfInWorkspace(e){let t=!1;if(c.workspace.workspaceFolders&&""!==e)for(const i of c.workspace.workspaceFolders)try{if(n.accessSync(i.uri.fsPath,n.constants.F_OK),t=e.includes(i.uri.fsPath),!0===t)break}catch{t=!1}return t}async existsLabelType(e,t){let i=!1;if(""!==t){i=!0;const s=new p(["lstype",`lbtype:${t}`]);try{await this.runCleartoolCommand("existsLabelType",s,(0,r.dirname)(e.fsPath),null,((e,t,s)=>{s.length>0&&(i=!1)}))}catch(e){return this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Information),!1}}return i}async createLabelType(e,t){if(""!==t&&!1===await this.existsLabelType(e,t)){const i=new p(["mklbtype","-nc",t]);try{await this.runCleartoolCommand("createLabelType",i,(0,r.dirname)(e.fsPath),null,((e,t)=>{this.outputChannel.appendLine(t)}))}catch(e){this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Error)}}}async applyLabel(e,t){if(""!==t&&!0===await this.existsLabelType(e,t)){const i=new p(["mklabel","-replace",t],[e.fsPath]);try{await this.runCleartoolCommand("applyLabel",i,(0,r.dirname)(e.fsPath),null,((e,t)=>{this.outputChannel.appendLine(t)}))}catch(e){this.outputChannel.appendLine((0,l.getErrorMessage)(e),m.LogLevel.Error)}}}async getVersionsOfFile(e){const t=await this.getVersionInformation(e);let i=[];return e&&""!==e.fsPath&&await this.runCleartoolCommand("getVersionsOfFile",new p(["lsvtree","-short"],[e.fsPath],t.version),(0,r.dirname)(e.fsPath),null,((e,t)=>{0===e&&""!==t&&(i=t.split("\n").filter((e=>e.indexOf("@@")>-1&&e.trim().match(/[\d]$/gi))).map((e=>{const t=e.indexOf("@@");return t>-1?e.substring(t+2).trim():e})).sort(((e,t)=>t.localeCompare(e))))})),i}}},767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMessage=void 0,t.getErrorMessage=function(e){return function(e){if("object"==typeof(t=e)&&null!==t&&"message"in t&&"string"==typeof t.message)return e;var t;try{return new Error(JSON.stringify(e))}catch{return new Error(String(e))}}(e).message}},238:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lock=void 0,t.Lock=class{constructor(e){this.mAccessCnt=e,this.mCount=0}reserve(){const e=this.mCount;return this.mCount++,e<this.mAccessCnt}release(){this.mCount--}}},5:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MappedList=void 0;const s=i(896),n=i(398);class o{constructor(e,t){this.found=e,this.name=t}}t.MappedList=class{constructor(){this.mUntrackedList=null,void 0!==n.workspace.workspaceFolders&&n.workspace.workspaceFolders.length>0&&(this.mUntrackedList=new Map,n.workspace.workspaceFolders.forEach((e=>{this.mUntrackedList?.set(e.uri.fsPath,[])})))}exists(e){if(null!==this.mUntrackedList){const t=this.mUntrackedList.keys();for(const i of t)if(e.includes(i)){const t=this.mUntrackedList.get(i),s=t?.find((t=>t.name===e));if(void 0!==s)return!0}}return!1}addString(e){if(null!==this.mUntrackedList&&void 0!==n.workspace.workspaceFolders){let t=0;for(;t<n.workspace.workspaceFolders.length&&!e.includes(n.workspace.workspaceFolders[t].uri.fsPath);t++);if(t<n.workspace.workspaceFolders.length){const i=this.mUntrackedList.get(n.workspace.workspaceFolders[t].uri.fsPath);void 0!==i&&(i.push(new o(!0,e)),this.mUntrackedList.set(n.workspace.workspaceFolders[t].uri.fsPath,i))}}}addStringByKey(e,t){if(null!==this.mUntrackedList&&void 0!==this.mUntrackedList.get(t)){const i=this.mUntrackedList.get(t),s=i?.find((t=>t.name===e));void 0===s&&void 0!==i?(i.push(new o(!0,e)),this.mUntrackedList.set(t,i)):void 0!==s&&(s.found=!0)}}addStringsByKey(e,t){null!==this.mUntrackedList&&void 0!==this.mUntrackedList.get(t)&&this.mUntrackedList.set(t,e)}getStringsByKey(e){if(void 0!==e)return null!==this.mUntrackedList&&void 0!==this.mUntrackedList.get(e)?this.mUntrackedList.get(e)?.map((e=>e.name)):[]}clearStringsOfKey(e){null!==this.mUntrackedList&&void 0!==this.mUntrackedList.get(e)&&this.mUntrackedList.set(e,[])}parse(e){if(null!==e&&null!==this.mUntrackedList)for(let t=0;t<e.length;t+=2)this.mUntrackedList.set(e[t],e[t+1].split(";").map((e=>new o(!1,e))))}stringify(){const e=[];if(null!==this.mUntrackedList){const t=this.mUntrackedList.keys();for(const i of t){const t=this.mUntrackedList.get(i)?.map((e=>e.name)).join(";");void 0!==t&&(e.push(i),e.push(t))}}return e}cleanMap(){if(null!==this.mUntrackedList){const e=this.mUntrackedList.keys();for(const t of e){const e=this.mUntrackedList.get(t)?.filter((e=>e.found));void 0!==e&&this.mUntrackedList.set(t,e.map((e=>(e.found=!1,e))))}}}updateEntryExistsOnFileSystem(){if(null!==this.mUntrackedList){const e=this.mUntrackedList.keys();for(const t of e){const e=this.mUntrackedList.get(t)?.filter((e=>{try{(0,s.accessSync)(e.name),e.found=!0}catch{e.found=!1}}));void 0!==e&&this.mUntrackedList.set(t,e)}}}resetFoundState(){if(null!==this.mUntrackedList){const e=this.mUntrackedList.keys();for(const t of e){const e=this.mUntrackedList.get(t);void 0!==e&&this.mUntrackedList.set(t,e.map((e=>(e.found=!1,e))))}}}}},188:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIInformation=void 0;const s=i(896),n=i(398),o=i(916);t.UIInformation=class{constructor(e,t,i){this.mConfigHandler=e,this.mEditor=t,this.mClearcase=i,this.mStatusbar=n.window.createStatusBarItem(n.StatusBarAlignment.Left),this.mIsActive=!0,this.mDisposables=[],this.handleConfigState(),this.mConfigHandler.onDidChangeConfiguration((()=>this.handleConfigState())),this.mDisposables.push(n.workspace.onDidOpenTextDocument((e=>this.receiveDocument(e)))),this.mDisposables.push(n.workspace.onDidSaveTextDocument((e=>this.receiveDocument(e)))),this.mDisposables.push(n.window.onDidChangeActiveTextEditor((e=>this.receiveEditor(e)))),this.mDisposables.push(n.window.onDidChangeTextEditorViewColumn((e=>this.receiveEditorColumn(e)))),this.mClearcase&&this.mDisposables.push(this.mClearcase.onCommandExecuted((()=>{this.initialQuery()}))),this.initialQuery()}receiveEditorColumn(e){e&&this.mIsActive&&(this.mEditor=e.textEditor,this.queryVersionInformation(this.mEditor.document.uri))}receiveDocument(e){e&&this.mIsActive&&(0,s.existsSync)(e.uri.fsPath)&&this.queryVersionInformation(e.uri)}receiveEditor(e){e&&this.mIsActive&&(this.mEditor=e,this.queryVersionInformation(e.document.uri))}handleConfigState(){this.mIsActive=this.mConfigHandler.configuration.showStatusbar.value,!1===this.mIsActive?this.mStatusbar?.hide():this.initialQuery()}initialQuery(){this.mIsActive&&this.mEditor?.document&&this.queryVersionInformation(this.mEditor.document.uri)}queryVersionInformation(e){"output"!==e.scheme&&this.mClearcase?.getVersionInformation(e).then((e=>this.updateStatusbar(e))).catch((()=>this.updateStatusbar(new o.CCVersionType)))}async updateStatusbar(e){if(void 0!==e)if(""!==e.version){if(null!==this.mStatusbar)switch(e.state){case 0:this.mStatusbar.text=`[${e.version}]`;break;case 1:this.mStatusbar.text="[HIJACKED]";break;default:this.mStatusbar.text=""}this.mStatusbar?.show()}else this.mStatusbar?.hide();else this.mStatusbar?.hide()}dispose(){this.mStatusbar?.dispose(),this.mDisposables.forEach((e=>e.dispose()))}}},230:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toCcUri=t.fromCcUri=void 0,t.fromCcUri=function(e){return JSON.parse(e.query)},t.toCcUri=function(e,t,i){return e.with({scheme:i??"cc-orig",path:e.path,query:JSON.stringify({path:e.fsPath,version:t})})}},526:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.loadMessageBundle=t.localize=t.format=t.setPseudo=t.isPseudo=t.isDefined=t.BundleFormat=t.MessageFormat=void 0;var s,n,o,r=i(124);function a(e){return void 0!==e}function c(e,i){return t.isPseudo&&(e="［"+e.replace(/[aouei]/g,"$&$&")+"］"),0===i.length?e:e.replace(/\{(\d+)\}/g,(function(e,t){var s=t[0],n=i[s],o=e;return"string"==typeof n?o=n:"number"!=typeof n&&"boolean"!=typeof n&&null!=n||(o=String(n)),o}))}(o=t.MessageFormat||(t.MessageFormat={})).file="file",o.bundle="bundle",o.both="both",(n=t.BundleFormat||(t.BundleFormat={})).standalone="standalone",n.languagePack="languagePack",function(e){e.is=function(e){var t=e;return t&&a(t.key)&&a(t.comment)}}(s||(s={})),t.isDefined=a,t.isPseudo=!1,t.setPseudo=function(e){t.isPseudo=e},t.format=c,t.localize=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];return c(t,i)},t.loadMessageBundle=function(e){return(0,r.default)().loadMessageBundle(e)},t.config=function(e){return(0,r.default)().config(e)}},124:(e,t)=>{"use strict";var i;function s(){if(void 0===i)throw new Error("No runtime abstraction layer installed");return i}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");i=e}}(s||(s={})),t.default=s},477:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.loadMessageBundle=t.BundleFormat=t.MessageFormat=void 0;var s=i(928),n=i(896),o=i(124),r=i(526),a=i(526);Object.defineProperty(t,"MessageFormat",{enumerable:!0,get:function(){return a.MessageFormat}}),Object.defineProperty(t,"BundleFormat",{enumerable:!0,get:function(){return a.BundleFormat}});var c,l,h=Object.prototype.toString;function d(e){return"[object String]"===h.call(e)}function u(e){return JSON.parse(n.readFileSync(e,"utf8"))}function m(e){return function(t,i){for(var s,n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return s=t,"[object Number]"===h.call(s)?t>=e.length?void console.error("Broken localize call found. Index out of bounds. Stacktrace is\n: ".concat(new Error("").stack)):(0,r.format)(e[t],n):d(i)?(console.warn("Message ".concat(i," didn't get externalized correctly.")),(0,r.format)(i,n)):void console.error("Broken localize call found. Stacktrace is\n: ".concat(new Error("").stack))}}function f(e,t){return c[e]=t,t}function C(e){try{return function(e){var t=u(s.join(e,"nls.metadata.json")),i=Object.create(null);for(var n in t){var o=t[n];i[n]=o.messages}return i}(e)}catch(e){return void console.log("Generating default bundle from meta data failed.",e)}}function p(e,t){var i;if(!0===l.languagePackSupport&&void 0!==l.cacheRoot&&void 0!==l.languagePackId&&void 0!==l.translationsConfigFile&&void 0!==l.translationsConfig)try{i=function(e,t){var i,o,r,a=s.join(l.cacheRoot,"".concat(e.id,"-").concat(e.hash,".json")),c=!1,h=!1;try{return i=JSON.parse(n.readFileSync(a,{encoding:"utf8",flag:"r"})),o=a,r=new Date,n.utimes(o,r,r,(function(){})),i}catch(e){if("ENOENT"===e.code)h=!0;else{if(!(e instanceof SyntaxError))throw e;console.log("Syntax error parsing message bundle: ".concat(e.message,".")),n.unlink(a,(function(e){e&&console.error("Deleting corrupted bundle ".concat(a," failed."))})),c=!0}}if(i=function(e,t){var i=l.translationsConfig[e.id];if(i){var n=u(i).contents,o=u(s.join(t,"nls.metadata.json")),r=Object.create(null);for(var a in o){var c=o[a],h=n["".concat(e.outDir,"/").concat(a)];if(h){for(var m=[],f=0;f<c.keys.length;f++){var C=c.keys[f],p=h[d(C)?C:C.key];void 0===p&&(p=c.messages[f]),m.push(p)}r[a]=m}else r[a]=c.messages}return r}}(e,t),!i||c)return i;if(h)try{n.writeFileSync(a,JSON.stringify(i),{encoding:"utf8",flag:"wx"})}catch(e){if("EEXIST"===e.code)return i;throw e}return i}(e,t)}catch(e){console.log("Load or create bundle failed ",e)}if(!i){if(l.languagePackSupport)return C(t);var o=function(e){for(var t=l.language;t;){var i=s.join(e,"nls.bundle.".concat(t,".json"));if(n.existsSync(i))return i;var o=t.lastIndexOf("-");t=o>0?t.substring(0,o):void 0}if(void 0===t&&(i=s.join(e,"nls.bundle.json"),n.existsSync(i)))return i}(t);if(o)try{return u(o)}catch(e){console.log("Loading in the box message bundle failed.",e)}i=C(t)}return i}function g(e){if(!e)return r.localize;var t=s.extname(e);if(t&&(e=e.substr(0,e.length-t.length)),l.messageFormat===r.MessageFormat.both||l.messageFormat===r.MessageFormat.bundle){var i=function(e){for(var t,i=s.dirname(e);t=s.join(i,"nls.metadata.header.json"),!n.existsSync(t);){var o=s.dirname(i);if(o===i){t=void 0;break}i=o}return t}(e);if(i){var o=s.dirname(i),a=c[o];if(void 0===a)try{var h=JSON.parse(n.readFileSync(i,"utf8"));try{var d=p(h,o);a=f(o,d?{header:h,nlsBundle:d}:null)}catch(e){console.error("Failed to load nls bundle",e),a=f(o,null)}}catch(e){console.error("Failed to read header file",e),a=f(o,null)}if(a){var C=e.substr(o.length+1).replace(/\\/g,"/"),g=a.nlsBundle[C];return void 0===g?(console.error("Messages for file ".concat(e," not found. See console for details.")),function(){return"Messages not found."}):m(g)}}}if(l.messageFormat===r.MessageFormat.both||l.messageFormat===r.MessageFormat.file)try{var w=u(function(e){var t;if(l.cacheLanguageResolution&&t);else{if(r.isPseudo||!l.language)t=".nls.json";else for(var i=l.language;i;){var s=".nls."+i+".json";if(n.existsSync(e+s)){t=s;break}var o=i.lastIndexOf("-");o>0?i=i.substring(0,o):(t=".nls.json",i=null)}l.cacheLanguageResolution}return e+t}(e));return Array.isArray(w)?m(w):(0,r.isDefined)(w.messages)&&(0,r.isDefined)(w.keys)?m(w.messages):(console.error("String bundle '".concat(e,"' uses an unsupported format.")),function(){return"File bundle has unsupported format. See console for details"})}catch(e){"ENOENT"!==e.code&&console.error("Failed to load single file bundle",e)}return console.error("Failed to load message bundle for file ".concat(e)),function(){return"Failed to load message bundle. See console for details."}}function w(e){return e&&(d(e.locale)&&(l.locale=e.locale.toLowerCase(),l.language=l.locale,c=Object.create(null)),void 0!==e.messageFormat&&(l.messageFormat=e.messageFormat),e.bundleFormat===r.BundleFormat.standalone&&!0===l.languagePackSupport&&(l.languagePackSupport=!1)),(0,r.setPseudo)("pseudo"===l.locale),g}!function(){if(l={locale:void 0,language:void 0,languagePackSupport:!1,cacheLanguageResolution:!0,messageFormat:r.MessageFormat.bundle},d(process.env.VSCODE_NLS_CONFIG))try{var e=JSON.parse(process.env.VSCODE_NLS_CONFIG),t=void 0;if(e.availableLanguages){var i=e.availableLanguages["*"];d(i)&&(t=i)}if(d(e.locale)&&(l.locale=e.locale.toLowerCase()),void 0===t?l.language=l.locale:"en"!==t&&(l.language=t),function(e){return!0===e||!1===e}(e._languagePackSupport)&&(l.languagePackSupport=e._languagePackSupport),d(e._cacheRoot)&&(l.cacheRoot=e._cacheRoot),d(e._languagePackId)&&(l.languagePackId=e._languagePackId),d(e._translationsConfigFile)){l.translationsConfigFile=e._translationsConfigFile;try{l.translationsConfig=u(l.translationsConfigFile)}catch(t){if(e._corruptedFile){var o=s.dirname(e._corruptedFile);n.exists(o,(function(t){t&&n.writeFile(e._corruptedFile,"corrupted","utf8",(function(e){console.error(e)}))}))}}}}catch(e){}(0,r.setPseudo)("pseudo"===l.locale),c=Object.create(null)}(),t.loadMessageBundle=g,t.config=w,o.default.install(Object.freeze({loadMessageBundle:g,config:w}))},398:e=>{"use strict";e.exports=require("vscode")},317:e=>{"use strict";e.exports=require("child_process")},982:e=>{"use strict";e.exports=require("crypto")},896:e=>{"use strict";e.exports=require("fs")},857:e=>{"use strict";e.exports=require("os")},928:e=>{"use strict";e.exports=require("path")}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,i),o.exports}var s={};(()=>{"use strict";var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=i(398),n=i(768),o=i(22),r=i(188),a=i(694);e.activate=async function(e){global.testExtensionContext=e;const i=[];e.subscriptions.push(new t.Disposable((()=>t.Disposable.from(...i).dispose()))),void 0!==t.workspace.workspaceFolders&&t.workspace.workspaceFolders.length>0&&await async function(e,i){console.log("[vscode-clearcase] starting!");const s=new a.default(t.window.createOutputChannel("Clearcase SCM")),c=new n.CCConfigHandler;i.push(c);const l=new o.CCScmProvider(e,s,c);i.push(l);try{if(!0===await l.init()){l.bindEvents(),l.bindCommands(),l.onWindowChanged((e=>{l.updateContextResources(e)}),l),l.updateIsView().then((e=>{l.updateContextResources(e)}));const e=new r.UIInformation(c,t.window.activeTextEditor,l.clearCase);i.push(e),console.log("[vscode-clearcase] started!")}}catch{t.window.showWarningMessage("VSCode-Clearcase extension could not be started")}}(e,i).catch((e=>console.error(e)))},e.deactivate=function(){}})(),module.exports=s})();